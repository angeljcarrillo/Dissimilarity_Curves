clear all
close;
clc

%% PATH FOR OTOLITHS FOLDER
% EXAMPLE
path='C:\Users\archi\Documents\Repos\Dissimilarity_Contours\software\otoliths\'; %% CHANGE PATH


dirListing = dir(path);

for i=1:length(dirListing) 
Data{i}=dirListing(i,1).name; 
f{i} = fullfile(path, Data{i});%----
end
f(:,1:2)=[];

%% NUMBER OF SEGMENTS
m=100;
%%

vec={};
SCC={};
TAU={};
ACC={};
ID=[];


%% CLEAR CONTOURS 

for i=1:1:length(f)
I= imread(f{:,i});
BW = I(:,:,1) >= 255;
I = bwlabel(BW,8);
[ty,tx,tz]=size(I);
BW = I(:,:,1);
u=bwboundaries(BW,8);
NC=length(u);
maxRow=0;
row=1;
%%% VERIFICATION ONE ONLY CONTOUR
     for m=1:1:NC
          if maxRow>= length(u{m,:})
              maxRow=maxRow;
              row=row;
          else
              maxRow=length(u{m,:});
              row=m;
          end
     end
C=u{row,1};
ind=sub2ind([ty tx],C(:,1),C(:,2));
% %% VIZUALIZAR %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
% %%%%%%%%%%%%%
Ie=zeros(ty,tx);
Ie(ind)=1;
%%%%%%%%%%%%%%%%%%%%% CONTOUR SEGMENTED
%  figure(1)
%  imagesc(Ie)
%  colormap(gray)
%  axis image
%  pause(1)
 
 pointlist=optimazeCurve(m,C);
 pointlist(end,:)=[]; 
 vec={vec{:,:} pointlist}; 
    scc=SCCF(pointlist(:,2),pointlist(:,1),0);  
    tau=sum(abs(scc));
    acc=sum(scc);
    TAU={TAU{:,:} tau};
    ACC={ACC{:,:} acc};
    SCC={SCC{:,:} scc}; 
    id = strsplit(f{:,i},'\');
    ID=[ID id(1,end)];    
end


%% CONTOURS TEST DELETE THIS PART FOR NEW DATA ----FROM HERE
persimilis=[-8.03920000000000,-0.149300000000000;-7,0;-6.06790000000000,0.160300000000000;-5.10770000000000,0.207500000000000;-4.16140000000000,0.372900000000000;-3.23570000000000,0.643600000000000;-2.28800000000000,0.941800000000000;-1.37690000000000,0.965800000000000;-0.431400000000000,0.849600000000000;0.528200000000000,0.662400000000000;1.48320000000000,0.425600000000000;2.45030000000000,0.225100000000000;3.40960000000000,0.140300000000000;4.36450000000000,-0.0337000000000000;5.21930000000000,-0.397900000000000;6.11350000000000,-0.818600000000000;6.85720000000000,-1.38270000000000;7.43170000000000,-2.10260000000000;8.05750000000000,-2.88100000000000;8.74810000000000,-3.54800000000000;9.41680000000000,-4.26810000000000;10.0225000000000,-5.03220000000000;10.5836000000000,-5.83640000000000;11.0601000000000,-6.68080000000000;11.3538000000000,-7.57150000000000;11.4677000000000,-8.50190000000000;11.5911000000000,-9.49360000000000;11.7043000000000,-10.4840000000000;11.7950000000000,-11.4728000000000;11.8497000000000,-12.4597000000000;11.9913000000000,-13.4205000000000;12.1879000000000,-14.3830000000000;12.1712000000000,-15.3130000000000;11.9724000000000,-16.2293000000000;11.7556000000000,-17.2038000000000;11.4853000000000,-18.1467000000000;11.2159000000000,-19.1078000000000;10.7928000000000,-19.9451000000000;10.3010000000000,-20.7949000000000;9.78390000000000,-21.6423000000000;9.40780000000000,-22.5196000000000;8.94370000000000,-23.3714000000000;8.30800000000000,-24.0281000000000;7.53040000000000,-24.5370000000000;6.66310000000000,-24.7583000000000;5.70460000000000,-24.9101000000000;4.82080000000000,-25.2291000000000;4.02860000000000,-25.7221000000000;3.25080000000000,-26.3056000000000;2.56290000000000,-26.9743000000000;1.83100000000000,-27.6402000000000;1.02710000000000,-28.1204000000000;0.146200000000000,-28.4870000000000;-0.716600000000000,-28.9363000000000;-1.56720000000000,-29.4325000000000;-2.43490000000000,-29.9183000000000;-3.32660000000000,-30.2214000000000;-4.23330000000000,-30.2544000000000;-5.15360000000000,-30.0954000000000;-6.13810000000000,-29.9322000000000;-7.09860000000000,-29.7210000000000;-8.07090000000000,-29.5448000000000;-9.00950000000000,-29.2898000000000;-9.82310000000000,-28.8476000000000;-10.5665000000000,-28.2623000000000;-11.3887000000000,-27.7653000000000;-12.2486000000000,-27.2658000000000;-12.8155000000000,-26.5824000000000;-13.3057000000000,-25.7666000000000;-13.8377000000000,-24.9293000000000;-14.3992000000000,-24.1167000000000;-14.8824000000000,-23.2722000000000;-15.2129000000000,-22.3838000000000;-15.5914000000000,-21.4708000000000;-16.0364000000000,-20.6043000000000;-16.4475000000000,-19.7082000000000;-16.6516000000000,-18.7976000000000;-16.9247000000000,-17.8561000000000;-17.2178000000000,-16.9055000000000;-17.5770000000000,-15.9990000000000;-17.8564000000000,-15.0673000000000;-17.8004000000000,-14.1819000000000;-17.7183000000000,-13.1915000000000;-17.7518000000000,-12.2295000000000;-17.8906000000000,-11.2744000000000;-17.8107000000000,-10.3513000000000;-17.6481000000000,-9.39080000000000;-17.4906000000000,-8.40620000000000;-17.3023000000000,-7.43480000000000;-16.9952000000000,-6.52840000000000;-16.6036000000000,-5.63880000000000;-16.0677000000000,-4.86830000000000;-15.4589000000000,-4.10030000000000;-14.7979000000000,-3.38100000000000;-14.0614000000000,-2.76990000000000;-13.2362000000000,-2.32830000000000;-12.3390000000000,-2.00710000000000;-11.4100000000000,-1.65400000000000;-10.4774000000000,-1.43300000000000;-9.38430000000000,-0.604700000000000;-8.03920000000000,-0.149300000000000];
persimilis(end,:)=[]; %% AVERAGE CONTOUR PERSIMILIS DELETE TAIL



   vec={persimilis vec{:,:}}; 
   vec2={};
   
   
%% PLOT ALL CONTOUS BY POINTS
   for j=1:1:length(vec)
       pointlist=vec{:,j};
       ptD=optimazeCurve(m,pointlist);
       vec2={vec2{:,:} ptD};
%        figure(1)
%         plot(ptD(:,1),ptD(:,2),'',ptD(:,1),ptD(:,2),'k-','LineWidth',2.0)
%         pause(1)
   end
%%
   
    newVec=vec2;

    % DISSIMILARITY METHOD
    % EPSILON VALUE
    EPSILON=0.1;
    J=dissimilarityFF(newVec,EPSILON);%(VECTOR OF CURVES, ALPHA)
    
    %PLOT DISSIMILARITY MATRIX
    figure (1)
    h = heatmap(J);   
    h.Colormap = hot(64);
    h.Title = 'Dissimilarity';
    h.XLabel = 'Dissimilarity Values';
    h.YLabel = strcat('\omega=',string(alpha));
    
    %% PLOT GHRAP
    C1=J(1,2:17);
    C2=J(1,18:33);    
    infoData={C1 C2};
    plus=0;
    xlabelD2={};
  for u=1:1:length(infoData)
        temp=infoData{:,u};
        colors=["b*","r*","k*"];
        
        xlabelD=randi([1+plus 5+plus],8);
        xlabelD2={xlabelD2{:,:} xlabelD(1,:)};
        plus=plus+5;
        figure(2)
        plot(temp,temp,colors(:,u),'LineWidth',10.0)
        hold on
        title('Dissimilarity');
        xlabel('Dissimilarity \omega');
        ylabel('Dissimilarity \omega');
        set(gca,'FontSize',35)
  end
    
    

    
%% Dissimilarity Procrustes 
    

Pdistance=[];
%%
for j=1:1:length(newVec)
    X=newVec{:,1};
    Y=newVec{:,j};
    d=procrustes(X,Y);
    Pdistance=[Pdistance d];
end

    C1=Pdistance(1,2:17);
    C2=Pdistance(1,18:33); 
    infoData2={C1 C2};
    plus=0;
    
  for u=1:1:length(infoData2)
        temp=infoData2{:,u};
        colors=["b*","r*","k*"];
        xlabelD3=xlabelD2{:,u};
        figure(3)
        plot(temp,temp,colors(:,u),'LineWidth',10.0)
        hold on
        title('Dissimilarity');
        xlabel('Dissimilarity Procrustes');
        ylabel('Dissimilarity Procrustes');
        set(gca,'FontSize',35)
  end


